{% import 'helpers.html' as helpers -%}
{% extends "base.html" %}

{% block strings %}

  strings:
    // Parsers will open files without the full 'rtf'
    $header_rtf = "{\\rt" nocase
    $header_office = { D0 CF 11 E0 }
    $header_xml = "<?xml version=" nocase wide ascii

    // Marks of embedded data (reduce FPs)
    // RTF format
    $embedded_object   = "\\object" nocase
    $embedded_objdata  = "\\objdata" nocase
    $embedded_ocx      = "\\objocx" nocase
    $embedded_objclass = "\\objclass" nocase
    $embedded_oleclass = "\\oleclsid" nocase
    
    // XML Office documents
    $embedded_axocx      = "<ax:ocx"  nocase wide ascii
    $embedded_axclassid  = "ax:classid"  nocase wide ascii

    // OLE format
    $embedded_root_entry = "Root Entry" wide
    $embedded_comp_obj   = "Comp Obj" wide
    $embedded_obj_info   = "Obj Info" wide
    $embedded_ole10      = "Ole10Native" wide

    {% set count = [] %}
    {%- for v in item.clsid|sort %}
      {%- set name = "data" + count|length|string -%}
      {%- if count.append(1) -%}{% endif %}
      {{ helpers.add_str(name, v, 'nocase wide ascii') }}
      {%- set name = "data" + count|length|string -%}
      {%- if count.append(1) -%}{% endif %}
      {{ helpers.add_hex(name, v|clsid_to_hex) }}
    {% endfor -%}
    {%- for v in item.strings|sort %}
      {%- set name = "data" + count|length|string -%}
      {%- if count.append(1) -%}{% endif %}
      {#- Output the raw string -#}
      {{ helpers.add_str(name, v, 'nocase wide ascii') }}
      {%- set name = "data" + count|length|string -%}
      {%- if count.append(1) -%}{% endif %}
      {#- Output the string as hex -#}
      {{ helpers.add_str(name, v|to_hex, 'nocase wide ascii') }}
    {% endfor -%}
 
{% endblock %}

{% block condition %}
    // Mandatory header plus sign of embedding, then any of the others
    for any of ($header*) : ( @ == 0 ) and 1 of ($embedded*) 
        and (1 of ($data*))
{% endblock %}
